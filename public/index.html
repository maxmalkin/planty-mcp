<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="global.css" />
		<title>planty-mcp</title>
	</head>
	<body>
		<header>
			<nav>
				<a href="/" class="active">[ HOME ]</a>
				<a href="/about.html">[ ABOUT ]</a>
			</nav>
		</header>
		<div class="container">
			<h1>planty-mcp</h1>

			<div class="ascii-plant">
<span class="green">   /\</span>              <span class="yellow">     ////</span>              <span class="yellow">    \|/</span>
<span class="green">  //\\</span>             <span class="yellow">    //  \\</span>             <span class="green">     |</span>
<span class="green"> ||  ||</span>            <span class="green">    ||    ||</span>            <span class="yellow">    |</span>
<span class="green"> ||  ||</span>            <span class="green">    ||    ||</span>            <span class="yellow">   / \</span>
<span class="yellow">||  ||</span>            <span class="yellow"> //||    ||\\</span>           <span class="green">  // \\</span>
<span class="yellow">||  ||</span>           <span class="green">  // ||    || \\</span>          <span class="green"> //   \\</span>
<span class="yellow">||  ||</span>           <span class="yellow">||  ||    ||  ||</span>         <span class="green"> ||   ||</span>
<span class="red">  ========</span>          <span class="red">==========   ======</span>           <span class="red">=========</span>
<span class="red">  |      |</span>          <span class="red">|        |   |    |</span>           <span class="red">|       |</span>
<span class="red">  |      |</span>          <span class="red">|        |   |    |</span>           <span class="red">|       |</span>
<span class="red">  |______|</span>          <span class="red">|________|   |____|</span>           <span class="red">|_______|</span>
			</div>

			<p class="tagline">MCP server for your plants</p>
			<p class="description">
				Manage your plants, watering schedules, growth tracking, and care notes
			</p>

			<button class="btn" id="generateBtn" onclick="generateKey()">
				[ GENERATE API KEY ]
			</button>

			<div class="key-display" id="keyDisplay">
				<div class="section-title">&gt; YOUR API KEY</div>
				<div class="api-key" id="apiKey"></div>
				<button class="btn" onclick="copyKey()">[ COPY TO CLIPBOARD ]</button>
				<p class="warning">
					! Save this key. You won't be able to see it again.
				</p>

				<div class="divider"></div>

				<div class="section-title">&gt; SETUP INSTRUCTIONS</div>
				<p class="description">
					Add this MCP server to Claude Desktop or ChatGPT:
				</p>

				<div class="info-box">
					<strong>ENDPOINT:</strong>
					<code>https://planty-mcp.onrender.com/sse</code>
				</div>

				<div class="info-box">
					<strong>API KEY:</strong>
					<code id="apiKeyInstructions"></code>
				</div>

				<div class="divider"></div>

				<!-- <div class="section-title">&gt; OPTIONAL: EMAIL RECOVERY</div>
				<input type="email" id="emailInput" placeholder="your@email.com" />
				<button class="btn" onclick="addEmail()">[ SAVE EMAIL ]</button>
				<p class="success" id="emailSuccess" style="display: none">
					âœ“ Email saved
				</p> -->
			</div>
		</div>

		<script>
			let currentApiKey = "";

			async function generateKey() {
				const btn = document.getElementById("generateBtn");
				btn.disabled = true;
				btn.textContent = "Generating...";

				try {
					const response = await fetch("/api/generate-key", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
					});

					const data = await response.json();

					if (!response.ok || data.error) {
						throw new Error(data.error || `Server error: ${response.status}`);
					}

					if (!data.apiKey) {
						throw new Error("No API key received from server");
					}

					currentApiKey = data.apiKey;

					document.getElementById("apiKey").textContent = currentApiKey;
					document.getElementById("apiKeyInstructions").textContent =
						currentApiKey;
					document.getElementById("keyDisplay").classList.add("show");
					btn.style.display = "none";
				} catch (error) {
					alert(`Error: ${error.message || "Failed to generate API key. Please try again."}`);
					btn.disabled = false;
					btn.textContent = "[ GENERATE API KEY ]";
				}
			}

			function copyKey() {
				navigator.clipboard.writeText(currentApiKey);
				alert("API key copied to clipboard!");
			}

			async function addEmail() {
				const email = document.getElementById("emailInput").value;
				if (!email) return;

				try {
					const response = await fetch("/api/add-email", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
							Authorization: `Bearer ${currentApiKey}`,
						},
						body: JSON.stringify({ email }),
					});

					if (response.ok) {
						document.getElementById("emailSuccess").style.display = "block";
					} else {
						const data = await response.json();
						alert(data.error || "Failed to add email");
					}
				} catch (error) {
					alert("Error adding email. Please try again.");
				}
			}
		</script>
	</body>
</html>
